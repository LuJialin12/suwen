#!/usr/bin/env python3
from pathlib import Path
import re
import sys

# 使い方:
# python scripts/add_ids_trans.py content/ch01/text.md content/ch01/trans.md

p_src = Path(sys.argv[1])   # 原文ファイル
p_trans = Path(sys.argv[2]) # 翻訳ファイル

src_lines = p_src.read_text(encoding="utf-8").splitlines()
trans_lines = p_trans.read_text(encoding="utf-8").splitlines()

# 原文のIDを抽出
id_pat = re.compile(r'^\[(ch\d{2}-\d{4}[a-z]?)\]\s')
ids = []
for ln in src_lines:
    m = id_pat.match(ln)
    if m:
        ids.append(m.group(1))

# 翻訳と対応付け
out = []
id_index = 0
for ln in trans_lines:
    if not ln.strip():  # 空行はそのまま
        out.append(ln)
        continue
    if id_pat.match(ln):  # すでにIDあり
        out.append(ln)
        continue
    if id_index < len(ids):  # 原文のIDをコピー
        out.append(f"[{ids[id_index]}] {ln}")
        id_index += 1
    else:
        out.append(ln)  # 原文の行数より多い場合はそのまま

p_trans.write_text("\n".join(out) + "\n", encoding="utf-8")
print(f"IDs copied from {p_src} to {p_trans}")
